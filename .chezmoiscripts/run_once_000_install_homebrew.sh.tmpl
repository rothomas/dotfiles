#!/bin/sh

. {{ .chezmoi.sourceDir }}/.helpers/prereq_functions

homebrew_install_apt_prereqs() {
  #################################################################################################
  #   APT PLATFORMS (Debian, Ubuntu)
  #################################################################################################
  require build-essential
  require procps
  require curl
  require file
  require git
  require bash
}

homebrew_install_yum_prereqs() {
  #################################################################################################
  #   YUM PLATFORMS (CentOS, RHEL, Fedora)
  #################################################################################################
  yum_install_group 'Development Tools'
  require procps-ng
  require curl
  require file
  require git
  require bash
  {{- if (eq .chezmoi.id "fedora") -}}
  require libxcrypt-compat
  {{- end -}}
}

homebrew_install_linux_prereqs() {
  if installed apt; then
    homebrew_install_apt_prereqs
  elif installed yum; then
    homebrew_install_yum_prereqs
  else
    echo "No supported package manager found for Linux prerequisites"
    exit 1
  fi
}

homebrew_install() {
  if ! installed brew; then
    {{- if (eq .chezmoi.os "linux") -}}
    homebrew_install_linux_prereqs
    {{- end -}}
    NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  fi
}

homebrew_install

