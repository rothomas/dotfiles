#!/bin/sh

. {{ .chezmoi.sourceDir }}/.helpers/prereq_functions

>&2 echo "homebrew: checking"
if ! installed brew; then
  get_sudo
{{ if eq .chezmoi.os "linux" -}}

{{   if eq .chezmoi.osRelease.id "ubuntu" "debian" }}
  $SUDO apt-get install -y bash build-essential curl file git procps sudo zsh
{{   end -}}

{{   if eq .chezmoi.osRelease.id "centos" "rhel" "fedora" }}
  $SUDO yum groupinstall -y 'Development Tools'
  $SUDO yum install -y bash curl file git procops-ng sudo zsh
{{     if eq .chezmoi.osRelease.id "fedora" }}
  $SUDO yum install -y libxcrypt-compat
{{     end -}}
{{   end -}}

{{   if eq .chezmoi.osRelease.id "alpine" }}
  $SUDO apk add --update bash build-base curl file git procps sudo zsh
{{   end -}}

{{ end }}

  >&2 echo "homebrew: installing"
  homebrew_script=`download https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh`

{{ if eq .chezmoi.os "linux" -}}
$SUDO adduser --system --gid 0 --shell /bin/bash linuxbrew
$SUDO usermod -G sudo linuxbrew
{{ end }}

NONINTERACTIVE=1 bash -c "${homebrew_script}"

else
  >&2 echo "homebrew: already installed"
fi

