#!/bin/sh

{{- if eq .chezmoi.os "linux"                                                         -}}
{{-   $packages := list                                                               -}}
{{-   $groups   := list                                                               -}}
{{-   $package_list := get .package .package_manager                                  -}}
{{-   range $package_list                                                             -}}
{{-     $packages = append $packages .package                                         -}}
{{-   end                                                                              }}

{{    if eq .package_manager "apk"                                                    -}}
{{.sudo}} apk add --update bash {{ $packages | join " " }}

{{    else if eq .package_manager "apt"                                               -}}
{{.sudo}} apt-get -yq update
{{.sudo}} apt-get -yqq install {{ $packages | join " " }}

{{    else if eq .package_manager "pacman"                                            -}}
{{.sudo}} pacman -Sy {{ $packages | join " " }}

{{    else if eq .package_manager "yum"                                               -}}
{{.sudo}} yum groupinstall -y {{ $groups | join " " }}
{{.sudo}} yum install -y {{ $packages | join " " }}

{{-    end                                                                            -}}
{{- end                                                                               -}}

gpg --recv-keys {{ .gpg_keys | join " " }}

bash -s <<EOF

{{- if and (eq .chezmoi.os "linux") (eq .chezmoi.username "root") }}
adduser --group --system --gecos "Linuxbrew User" linuxbrew
{{- end }}


EOF
